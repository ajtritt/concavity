from shapely import wkt
from concavity.utils import *
import concavity
import geopandas as gpd
def test_ccw():
    poly = 'MULTIPOLYGON (((594647.0667507884 4522674.566219987, 594646.592616698 4522674.560806693, 594646.1173994918 4522674.650260204, 594645.6412002802 4522674.834481692, 594645.3545347397 4522675.020867131, 594645.0679691692 4522675.207253711, 594644.78022166 4522675.488405988, 594644.5884229253 4522675.675874537, 594644.4904078833 4522675.959293013, 594644.3933759925 4522676.147843536, 594644.2964440649 4522676.336395207, 594644.2953609476 4522676.431262012, 594644.2942789745 4522676.526028849, 594644.2931958582 4522676.620895652, 594644.3836325163 4522677.001244913, 594644.5689359742 4522677.382677284, 594644.9395428993 4522678.145542037, 594646.336946079 4522680.342617664, 594647.4595922981 4522681.683043725, 594650.458105961 4522684.846691469, 594651.1120302448 4522685.707670116, 594651.6712876486 4522686.567567924, 594652.0408125867 4522687.425199538, 594652.3133044783 4522688.471481643, 594652.5707406583 4522690.845200411, 594652.6319479216 4522693.785653886, 594652.5133649994 4522695.87054201, 594652.4055064576 4522697.007360729, 594652.3009972407 4522697.859580174, 594652.0089183719 4522698.520099699, 594651.9098213329 4522698.898285007, 594651.7169394653 4522699.180620356, 594651.5251407179 4522699.368088905, 594651.2373931889 4522699.649241168, 594650.6630789312 4522700.116879961, 594649.9960641109 4522700.393702026, 594649.7094985251 4522700.58008859, 594649.329148117 4522700.67062519, 594646.1924646263 4522701.29866705, 594642.7693166803 4522702.112996635, 594641.9137502084 4522702.292886749, 594641.1508854437 4522702.663493622, 594639.6219076898 4522703.689207812, 594638.9516446595 4522704.250530303, 594638.3751653109 4522704.907802718, 594637.7976039828 4522705.659841969, 594637.5055251105 4522706.32036146, 594637.2113822387 4522707.170415768, 594637.0098399576 4522708.211285664, 594636.9676198401 4522711.909191604, 594636.8630094893 4522712.761509838, 594636.7606642105 4522713.424195576, 594635.0729483863 4522720.043068892, 594633.2031761496 4522725.996109301, 594632.8991897015 4522727.699563793, 594632.7838537218 4522729.500051342, 594632.778440367 4522729.974185417, 594632.8677949884 4522730.449301517, 594633.413961628 4522732.447000032, 594633.5034150727 4522732.922217235, 594633.4990848432 4522733.301484506, 594633.2878000479 4522735.195655763, 594632.5893893272 4522738.222315441, 594632.3900132307 4522739.073451705, 594631.7036111753 4522741.05707753, 594631.5085641695 4522741.529046486, 594631.4082851453 4522742.001997461, 594631.4039537661 4522742.3813647, 594631.400706658 4522742.665765173, 594631.4923252066 4522742.95134874, 594631.5838449365 4522743.2368312, 594631.7702303202 4522743.523496755, 594631.8607668839 4522743.903847161, 594632.3283056295 4522744.4781603, 594632.9855779817 4522745.054639702, 594633.7376171693 4522745.632201093, 594636.0896835243 4522747.27120158, 594639.6690062922 4522749.398310064, 594641.3670474202 4522750.176430695, 594641.4038609939 4522750.192047674, 594642.9714059957 4522750.858502572, 594645.1457474874 4522751.452302983, 594647.4170209564 4522751.857551747, 594647.9848387516 4522751.958913924, 594649.6011049544 4522751.598050754, 594651.7895203513 4522750.959182505, 594652.265819571 4522750.774962236, 594652.8379676198 4522750.497057118, 594653.8896631461 4522749.75043128, 594654.9445069629 4522748.719303844, 594656.0016158648 4522747.498543897, 594656.9660230839 4522746.087067169, 594657.7418786404 4522744.578658468, 594658.424050478 4522742.974300969, 594659.0135206297 4522741.179226685, 594659.4155222375 4522739.19235363, 594659.8196889546 4522737.015846922, 594660.1626486828 4522731.898886679, 594660.3033832432 4522719.572499558, 594660.7047017944 4522709.33532966, 594660.707950022 4522709.050829206, 594660.6164302626 4522708.765346732, 594660.5248116843 4522708.479763152, 594660.4332930704 4522708.194180711, 594659.870887435 4522707.618784455, 594658.6512093586 4522706.466908817, 594658.1835705641 4522705.892594542, 594657.902418299 4522705.604847004, 594657.8107985742 4522705.319363395, 594657.7203619394 4522704.939014114, 594657.7214450615 4522704.844147309, 594657.6287433598 4522704.65343054, 594657.8833311874 4522698.96648623, 594658.5258466337 4522692.525337524, 594658.7284708613 4522691.389700725, 594659.5239131951 4522688.174490258, 594659.6295055163 4522687.227403988, 594659.6392490137 4522686.374002587, 594659.5520605686 4522685.709152856, 594659.3700041812 4522685.043319975, 594658.8150769478 4522683.80415485, 594657.8820643607 4522682.465893845, 594656.3855641239 4522680.647003468, 594654.5141267765 4522678.444515629, 594653.1069800786 4522677.100841354, 594651.7914531243 4522676.042650689, 594651.1320155647 4522675.655805008, 594650.3767291893 4522675.3626442, 594648.866055336 4522674.776421409, 594647.6356517188 4522674.572715255, 594647.0667507884 4522674.566219987)), ((594614.8674549732 4522792.384238604, 594615.2925413586 4522794.583910028, 594616.1636605011 4522795.835183428, 594618.4122929578 4522798.135857604, 594620.6623419363 4522799.804586753, 594621.5061227813 4522800.551858653, 594623.192018644 4522805.808757254, 594625.1670847301 4522808.899833824, 594627.4310254259 4522813.730127485, 594627.6428971349 4522814.315218597, 594628.108370599 4522815.079166584, 594629.4119893719 4522817.180292628, 594629.7836780364 4522817.848390635, 594629.9668162147 4522818.419456693, 594630.9158658219 4522822.687557745, 594632.1362842089 4522828.914627742, 594632.4809485832 4522830.776255089, 594632.7394671144 4522833.05510703, 594632.8245901242 4522833.90959153, 594632.9182749547 4522834.005440373, 594632.917191803 4522834.100307172, 594633.0098934429 4522834.29102396, 594633.1973619201 4522834.482822758, 594633.3848303985 4522834.674621555, 594633.5733820222 4522834.77155355, 594633.7619325098 4522834.86858551, 594633.9515661482 4522834.87075067, 594634.1411997814 4522834.872915829, 594634.2359666215 4522834.873997839, 594634.5204670586 4522834.877246151, 594634.8059506828 4522834.78562652, 594635.4718835533 4522834.603571514, 594636.0451147886 4522834.230799719, 594636.3317803883 4522834.044414389, 594636.5235791869 4522833.85694591, 594636.7142948303 4522833.764344232, 594636.8112268255 4522833.575792605, 594636.9082587892 4522833.387242121, 594637.0051907843 4522833.19869049, 594637.1043879056 4522832.82050636, 594637.2013210428 4522832.631854766, 594637.2034862015 4522832.442221129, 594637.20565136 4522832.252587493, 594636.6789715996 4522828.548186089, 594635.8271545352 4522820.098513478, 594635.3834337108 4522817.438130269, 594634.5755005379 4522813.446080132, 594633.7567427299 4522810.40209823, 594633.2956995112 4522809.258884104, 594632.8334743258 4522808.210435678, 594632.7396906716 4522808.114485737, 594632.6460058395 4522808.018636893, 594632.5522221825 4522807.922686949, 594632.4574553478 4522807.921604948, 594632.3636705475 4522807.825754968, 594630.3020807185 4522803.985354777, 594630.1171299941 4522801.655354245, 594631.1248612038 4522796.799628741, 594631.5586338594 4522794.368116318, 594632.3248856366 4522793.184226864, 594633.0881638918 4522792.646061672, 594633.5428710147 4522790.894139091, 594633.353058125 4522786.984729802, 594634.0693205523 4522782.04429426, 594633.9150028032 4522779.491892377, 594632.5624665357 4522775.116507147, 594632.4916122896 4522774.430848543, 594633.076605519 4522773.842258378, 594634.4612896753 4522773.615621177, 594637.8822725578 4522772.990925819, 594640.8293224506 4522772.360719365, 594641.4003885088 4522772.177581122, 594641.877669752 4522771.898592905, 594642.4509020799 4522771.525721054, 594642.9304484238 4522771.057100333, 594643.4110779061 4522770.49361281, 594643.7979237227 4522769.834175344, 594644.0888195971 4522769.268521545, 594644.3808985696 4522768.608002086, 594645.2666769295 4522765.77323997, 594645.5749949357 4522763.690418205, 594645.7054869558 4522760.562495115, 594645.8036008829 4522760.279177768, 594645.9027979382 4522759.900993613, 594646.2961391201 4522758.672655212, 594646.4911861509 4522758.200686249, 594646.5902832415 4522757.822500953, 594646.5935303587 4522757.53810047, 594646.5009286472 4522757.347384838, 594646.5030937727 4522757.157751194, 594646.4103920931 4522756.967034414, 594646.317791521 4522756.776218816, 594646.2250898411 4522756.585502043, 594646.0376213272 4522756.393703274, 594645.849069676 4522756.296771311, 594645.4730506454 4522756.007940611, 594644.9073968375 4522755.717044754, 594644.3406610377 4522755.520915739, 594642.1663195554 4522754.92711531, 594631.8808353218 4522750.447439556, 594630.8421305859 4522750.056263535, 594628.4781555277 4522749.460298027, 594627.8144877856 4522749.452720671, 594627.0559532515 4522749.444060182, 594626.3900204264 4522749.626115319, 594625.6293207674 4522749.807088464, 594624.1035912095 4522750.548302016, 594622.1941641825 4522751.664451439, 594620.6630212541 4522752.879799042, 594619.1297132038 4522754.284780262, 594617.782691704 4522755.976325926, 594616.4336050395 4522757.857506345, 594615.1771189347 4522759.929502338, 594614.2072995203 4522761.81501299, 594613.5240456845 4522763.514137126, 594613.1263742656 4522765.121742693, 594613.0175335183 4522766.353329263, 594613.0023776081 4522767.680764661, 594613.1768541831 4522769.010465148, 594613.5420486598 4522770.247364009, 594614.0936273492 4522771.771028397, 594614.7444042341 4522772.916408705, 594615.0323338064 4522773.284815943, 594615.4024185715 4522774.522470495, 594615.6734967716 4522778.529686178, 594616.2623741737 4522782.557126689, 594615.5756547228 4522787.099186889, 594614.8467664588 4522789.879252461, 594614.8674549732 4522792.384238604), (594618.9116443855 4522791.475522819, 594617.7732181982 4522789.240512805, 594619.2161811623 4522783.331589034, 594620.4307067465 4522778.901431744, 594620.3930837843 4522776.574912989, 594620.7052141157 4522775.357844772, 594620.8976258669 4522775.072904678, 594621.9267656893 4522775.084654837, 594625.6588444355 4522774.795838457, 594627.2161641449 4522775.701124203, 594629.1084868275 4522778.788856464, 594630.0026731484 4522783.87795061, 594629.8339972025 4522789.378216612, 594628.6425228592 4522791.798178609, 594625.1439971291 4522792.393094804, 594624.0925769696 4522792.730313535, 594622.4727561466 4522792.737013704, 594618.9116443855 4522791.475522819)))'
    poly = wkt.loads(poly)
    assert poly[1].exterior.is_ccw == False
    assert poly[1].interiors[0].is_ccw == True
    poly = make_ccw(poly)
    assert poly[1].exterior.is_ccw == True
    assert poly[1].interiors[0].is_ccw == False


def test_list_output():
    poly = 'MULTIPOLYGON (((594647.0667507884 4522674.566219987, 594646.592616698 4522674.560806693, 594646.1173994918 4522674.650260204, 594645.6412002802 4522674.834481692, 594645.3545347397 4522675.020867131, 594645.0679691692 4522675.207253711, 594644.78022166 4522675.488405988, 594644.5884229253 4522675.675874537, 594644.4904078833 4522675.959293013, 594644.3933759925 4522676.147843536, 594644.2964440649 4522676.336395207, 594644.2953609476 4522676.431262012, 594644.2942789745 4522676.526028849, 594644.2931958582 4522676.620895652, 594644.3836325163 4522677.001244913, 594644.5689359742 4522677.382677284, 594644.9395428993 4522678.145542037, 594646.336946079 4522680.342617664, 594647.4595922981 4522681.683043725, 594650.458105961 4522684.846691469, 594651.1120302448 4522685.707670116, 594651.6712876486 4522686.567567924, 594652.0408125867 4522687.425199538, 594652.3133044783 4522688.471481643, 594652.5707406583 4522690.845200411, 594652.6319479216 4522693.785653886, 594652.5133649994 4522695.87054201, 594652.4055064576 4522697.007360729, 594652.3009972407 4522697.859580174, 594652.0089183719 4522698.520099699, 594651.9098213329 4522698.898285007, 594651.7169394653 4522699.180620356, 594651.5251407179 4522699.368088905, 594651.2373931889 4522699.649241168, 594650.6630789312 4522700.116879961, 594649.9960641109 4522700.393702026, 594649.7094985251 4522700.58008859, 594649.329148117 4522700.67062519, 594646.1924646263 4522701.29866705, 594642.7693166803 4522702.112996635, 594641.9137502084 4522702.292886749, 594641.1508854437 4522702.663493622, 594639.6219076898 4522703.689207812, 594638.9516446595 4522704.250530303, 594638.3751653109 4522704.907802718, 594637.7976039828 4522705.659841969, 594637.5055251105 4522706.32036146, 594637.2113822387 4522707.170415768, 594637.0098399576 4522708.211285664, 594636.9676198401 4522711.909191604, 594636.8630094893 4522712.761509838, 594636.7606642105 4522713.424195576, 594635.0729483863 4522720.043068892, 594633.2031761496 4522725.996109301, 594632.8991897015 4522727.699563793, 594632.7838537218 4522729.500051342, 594632.778440367 4522729.974185417, 594632.8677949884 4522730.449301517, 594633.413961628 4522732.447000032, 594633.5034150727 4522732.922217235, 594633.4990848432 4522733.301484506, 594633.2878000479 4522735.195655763, 594632.5893893272 4522738.222315441, 594632.3900132307 4522739.073451705, 594631.7036111753 4522741.05707753, 594631.5085641695 4522741.529046486, 594631.4082851453 4522742.001997461, 594631.4039537661 4522742.3813647, 594631.400706658 4522742.665765173, 594631.4923252066 4522742.95134874, 594631.5838449365 4522743.2368312, 594631.7702303202 4522743.523496755, 594631.8607668839 4522743.903847161, 594632.3283056295 4522744.4781603, 594632.9855779817 4522745.054639702, 594633.7376171693 4522745.632201093, 594636.0896835243 4522747.27120158, 594639.6690062922 4522749.398310064, 594641.3670474202 4522750.176430695, 594641.4038609939 4522750.192047674, 594642.9714059957 4522750.858502572, 594645.1457474874 4522751.452302983, 594647.4170209564 4522751.857551747, 594647.9848387516 4522751.958913924, 594649.6011049544 4522751.598050754, 594651.7895203513 4522750.959182505, 594652.265819571 4522750.774962236, 594652.8379676198 4522750.497057118, 594653.8896631461 4522749.75043128, 594654.9445069629 4522748.719303844, 594656.0016158648 4522747.498543897, 594656.9660230839 4522746.087067169, 594657.7418786404 4522744.578658468, 594658.424050478 4522742.974300969, 594659.0135206297 4522741.179226685, 594659.4155222375 4522739.19235363, 594659.8196889546 4522737.015846922, 594660.1626486828 4522731.898886679, 594660.3033832432 4522719.572499558, 594660.7047017944 4522709.33532966, 594660.707950022 4522709.050829206, 594660.6164302626 4522708.765346732, 594660.5248116843 4522708.479763152, 594660.4332930704 4522708.194180711, 594659.870887435 4522707.618784455, 594658.6512093586 4522706.466908817, 594658.1835705641 4522705.892594542, 594657.902418299 4522705.604847004, 594657.8107985742 4522705.319363395, 594657.7203619394 4522704.939014114, 594657.7214450615 4522704.844147309, 594657.6287433598 4522704.65343054, 594657.8833311874 4522698.96648623, 594658.5258466337 4522692.525337524, 594658.7284708613 4522691.389700725, 594659.5239131951 4522688.174490258, 594659.6295055163 4522687.227403988, 594659.6392490137 4522686.374002587, 594659.5520605686 4522685.709152856, 594659.3700041812 4522685.043319975, 594658.8150769478 4522683.80415485, 594657.8820643607 4522682.465893845, 594656.3855641239 4522680.647003468, 594654.5141267765 4522678.444515629, 594653.1069800786 4522677.100841354, 594651.7914531243 4522676.042650689, 594651.1320155647 4522675.655805008, 594650.3767291893 4522675.3626442, 594648.866055336 4522674.776421409, 594647.6356517188 4522674.572715255, 594647.0667507884 4522674.566219987)), ((594614.8674549732 4522792.384238604, 594615.2925413586 4522794.583910028, 594616.1636605011 4522795.835183428, 594618.4122929578 4522798.135857604, 594620.6623419363 4522799.804586753, 594621.5061227813 4522800.551858653, 594623.192018644 4522805.808757254, 594625.1670847301 4522808.899833824, 594627.4310254259 4522813.730127485, 594627.6428971349 4522814.315218597, 594628.108370599 4522815.079166584, 594629.4119893719 4522817.180292628, 594629.7836780364 4522817.848390635, 594629.9668162147 4522818.419456693, 594630.9158658219 4522822.687557745, 594632.1362842089 4522828.914627742, 594632.4809485832 4522830.776255089, 594632.7394671144 4522833.05510703, 594632.8245901242 4522833.90959153, 594632.9182749547 4522834.005440373, 594632.917191803 4522834.100307172, 594633.0098934429 4522834.29102396, 594633.1973619201 4522834.482822758, 594633.3848303985 4522834.674621555, 594633.5733820222 4522834.77155355, 594633.7619325098 4522834.86858551, 594633.9515661482 4522834.87075067, 594634.1411997814 4522834.872915829, 594634.2359666215 4522834.873997839, 594634.5204670586 4522834.877246151, 594634.8059506828 4522834.78562652, 594635.4718835533 4522834.603571514, 594636.0451147886 4522834.230799719, 594636.3317803883 4522834.044414389, 594636.5235791869 4522833.85694591, 594636.7142948303 4522833.764344232, 594636.8112268255 4522833.575792605, 594636.9082587892 4522833.387242121, 594637.0051907843 4522833.19869049, 594637.1043879056 4522832.82050636, 594637.2013210428 4522832.631854766, 594637.2034862015 4522832.442221129, 594637.20565136 4522832.252587493, 594636.6789715996 4522828.548186089, 594635.8271545352 4522820.098513478, 594635.3834337108 4522817.438130269, 594634.5755005379 4522813.446080132, 594633.7567427299 4522810.40209823, 594633.2956995112 4522809.258884104, 594632.8334743258 4522808.210435678, 594632.7396906716 4522808.114485737, 594632.6460058395 4522808.018636893, 594632.5522221825 4522807.922686949, 594632.4574553478 4522807.921604948, 594632.3636705475 4522807.825754968, 594630.3020807185 4522803.985354777, 594630.1171299941 4522801.655354245, 594631.1248612038 4522796.799628741, 594631.5586338594 4522794.368116318, 594632.3248856366 4522793.184226864, 594633.0881638918 4522792.646061672, 594633.5428710147 4522790.894139091, 594633.353058125 4522786.984729802, 594634.0693205523 4522782.04429426, 594633.9150028032 4522779.491892377, 594632.5624665357 4522775.116507147, 594632.4916122896 4522774.430848543, 594633.076605519 4522773.842258378, 594634.4612896753 4522773.615621177, 594637.8822725578 4522772.990925819, 594640.8293224506 4522772.360719365, 594641.4003885088 4522772.177581122, 594641.877669752 4522771.898592905, 594642.4509020799 4522771.525721054, 594642.9304484238 4522771.057100333, 594643.4110779061 4522770.49361281, 594643.7979237227 4522769.834175344, 594644.0888195971 4522769.268521545, 594644.3808985696 4522768.608002086, 594645.2666769295 4522765.77323997, 594645.5749949357 4522763.690418205, 594645.7054869558 4522760.562495115, 594645.8036008829 4522760.279177768, 594645.9027979382 4522759.900993613, 594646.2961391201 4522758.672655212, 594646.4911861509 4522758.200686249, 594646.5902832415 4522757.822500953, 594646.5935303587 4522757.53810047, 594646.5009286472 4522757.347384838, 594646.5030937727 4522757.157751194, 594646.4103920931 4522756.967034414, 594646.317791521 4522756.776218816, 594646.2250898411 4522756.585502043, 594646.0376213272 4522756.393703274, 594645.849069676 4522756.296771311, 594645.4730506454 4522756.007940611, 594644.9073968375 4522755.717044754, 594644.3406610377 4522755.520915739, 594642.1663195554 4522754.92711531, 594631.8808353218 4522750.447439556, 594630.8421305859 4522750.056263535, 594628.4781555277 4522749.460298027, 594627.8144877856 4522749.452720671, 594627.0559532515 4522749.444060182, 594626.3900204264 4522749.626115319, 594625.6293207674 4522749.807088464, 594624.1035912095 4522750.548302016, 594622.1941641825 4522751.664451439, 594620.6630212541 4522752.879799042, 594619.1297132038 4522754.284780262, 594617.782691704 4522755.976325926, 594616.4336050395 4522757.857506345, 594615.1771189347 4522759.929502338, 594614.2072995203 4522761.81501299, 594613.5240456845 4522763.514137126, 594613.1263742656 4522765.121742693, 594613.0175335183 4522766.353329263, 594613.0023776081 4522767.680764661, 594613.1768541831 4522769.010465148, 594613.5420486598 4522770.247364009, 594614.0936273492 4522771.771028397, 594614.7444042341 4522772.916408705, 594615.0323338064 4522773.284815943, 594615.4024185715 4522774.522470495, 594615.6734967716 4522778.529686178, 594616.2623741737 4522782.557126689, 594615.5756547228 4522787.099186889, 594614.8467664588 4522789.879252461, 594614.8674549732 4522792.384238604), (594618.9116443855 4522791.475522819, 594617.7732181982 4522789.240512805, 594619.2161811623 4522783.331589034, 594620.4307067465 4522778.901431744, 594620.3930837843 4522776.574912989, 594620.7052141157 4522775.357844772, 594620.8976258669 4522775.072904678, 594621.9267656893 4522775.084654837, 594625.6588444355 4522774.795838457, 594627.2161641449 4522775.701124203, 594629.1084868275 4522778.788856464, 594630.0026731484 4522783.87795061, 594629.8339972025 4522789.378216612, 594628.6425228592 4522791.798178609, 594625.1439971291 4522792.393094804, 594624.0925769696 4522792.730313535, 594622.4727561466 4522792.737013704, 594618.9116443855 4522791.475522819)))'
    poly = wkt.loads(poly)

    geoms, angles = concavity.find_convex_vertices(poly, 0, filter_type='peak', output_type='list')
    assert len(geoms) == len(angles)

    geoms, angles = concavity.find_convex_vertices(poly, 10, filter_type='all', output_type='list')
    assert len(geoms) == len(angles)

    geoms, angles = concavity.find_concave_vertices(poly, 0, filter_type='peak', output_type='list')
    assert len(geoms) == len(angles)

    geoms, angles = concavity.find_concave_vertices(poly, 10, filter_type='all', output_type='list')
    assert len(geoms) == len(angles)


def test_geopandas_output():
    poly = 'MULTIPOLYGON (((594647.0667507884 4522674.566219987, 594646.592616698 4522674.560806693, 594646.1173994918 4522674.650260204, 594645.6412002802 4522674.834481692, 594645.3545347397 4522675.020867131, 594645.0679691692 4522675.207253711, 594644.78022166 4522675.488405988, 594644.5884229253 4522675.675874537, 594644.4904078833 4522675.959293013, 594644.3933759925 4522676.147843536, 594644.2964440649 4522676.336395207, 594644.2953609476 4522676.431262012, 594644.2942789745 4522676.526028849, 594644.2931958582 4522676.620895652, 594644.3836325163 4522677.001244913, 594644.5689359742 4522677.382677284, 594644.9395428993 4522678.145542037, 594646.336946079 4522680.342617664, 594647.4595922981 4522681.683043725, 594650.458105961 4522684.846691469, 594651.1120302448 4522685.707670116, 594651.6712876486 4522686.567567924, 594652.0408125867 4522687.425199538, 594652.3133044783 4522688.471481643, 594652.5707406583 4522690.845200411, 594652.6319479216 4522693.785653886, 594652.5133649994 4522695.87054201, 594652.4055064576 4522697.007360729, 594652.3009972407 4522697.859580174, 594652.0089183719 4522698.520099699, 594651.9098213329 4522698.898285007, 594651.7169394653 4522699.180620356, 594651.5251407179 4522699.368088905, 594651.2373931889 4522699.649241168, 594650.6630789312 4522700.116879961, 594649.9960641109 4522700.393702026, 594649.7094985251 4522700.58008859, 594649.329148117 4522700.67062519, 594646.1924646263 4522701.29866705, 594642.7693166803 4522702.112996635, 594641.9137502084 4522702.292886749, 594641.1508854437 4522702.663493622, 594639.6219076898 4522703.689207812, 594638.9516446595 4522704.250530303, 594638.3751653109 4522704.907802718, 594637.7976039828 4522705.659841969, 594637.5055251105 4522706.32036146, 594637.2113822387 4522707.170415768, 594637.0098399576 4522708.211285664, 594636.9676198401 4522711.909191604, 594636.8630094893 4522712.761509838, 594636.7606642105 4522713.424195576, 594635.0729483863 4522720.043068892, 594633.2031761496 4522725.996109301, 594632.8991897015 4522727.699563793, 594632.7838537218 4522729.500051342, 594632.778440367 4522729.974185417, 594632.8677949884 4522730.449301517, 594633.413961628 4522732.447000032, 594633.5034150727 4522732.922217235, 594633.4990848432 4522733.301484506, 594633.2878000479 4522735.195655763, 594632.5893893272 4522738.222315441, 594632.3900132307 4522739.073451705, 594631.7036111753 4522741.05707753, 594631.5085641695 4522741.529046486, 594631.4082851453 4522742.001997461, 594631.4039537661 4522742.3813647, 594631.400706658 4522742.665765173, 594631.4923252066 4522742.95134874, 594631.5838449365 4522743.2368312, 594631.7702303202 4522743.523496755, 594631.8607668839 4522743.903847161, 594632.3283056295 4522744.4781603, 594632.9855779817 4522745.054639702, 594633.7376171693 4522745.632201093, 594636.0896835243 4522747.27120158, 594639.6690062922 4522749.398310064, 594641.3670474202 4522750.176430695, 594641.4038609939 4522750.192047674, 594642.9714059957 4522750.858502572, 594645.1457474874 4522751.452302983, 594647.4170209564 4522751.857551747, 594647.9848387516 4522751.958913924, 594649.6011049544 4522751.598050754, 594651.7895203513 4522750.959182505, 594652.265819571 4522750.774962236, 594652.8379676198 4522750.497057118, 594653.8896631461 4522749.75043128, 594654.9445069629 4522748.719303844, 594656.0016158648 4522747.498543897, 594656.9660230839 4522746.087067169, 594657.7418786404 4522744.578658468, 594658.424050478 4522742.974300969, 594659.0135206297 4522741.179226685, 594659.4155222375 4522739.19235363, 594659.8196889546 4522737.015846922, 594660.1626486828 4522731.898886679, 594660.3033832432 4522719.572499558, 594660.7047017944 4522709.33532966, 594660.707950022 4522709.050829206, 594660.6164302626 4522708.765346732, 594660.5248116843 4522708.479763152, 594660.4332930704 4522708.194180711, 594659.870887435 4522707.618784455, 594658.6512093586 4522706.466908817, 594658.1835705641 4522705.892594542, 594657.902418299 4522705.604847004, 594657.8107985742 4522705.319363395, 594657.7203619394 4522704.939014114, 594657.7214450615 4522704.844147309, 594657.6287433598 4522704.65343054, 594657.8833311874 4522698.96648623, 594658.5258466337 4522692.525337524, 594658.7284708613 4522691.389700725, 594659.5239131951 4522688.174490258, 594659.6295055163 4522687.227403988, 594659.6392490137 4522686.374002587, 594659.5520605686 4522685.709152856, 594659.3700041812 4522685.043319975, 594658.8150769478 4522683.80415485, 594657.8820643607 4522682.465893845, 594656.3855641239 4522680.647003468, 594654.5141267765 4522678.444515629, 594653.1069800786 4522677.100841354, 594651.7914531243 4522676.042650689, 594651.1320155647 4522675.655805008, 594650.3767291893 4522675.3626442, 594648.866055336 4522674.776421409, 594647.6356517188 4522674.572715255, 594647.0667507884 4522674.566219987)), ((594614.8674549732 4522792.384238604, 594615.2925413586 4522794.583910028, 594616.1636605011 4522795.835183428, 594618.4122929578 4522798.135857604, 594620.6623419363 4522799.804586753, 594621.5061227813 4522800.551858653, 594623.192018644 4522805.808757254, 594625.1670847301 4522808.899833824, 594627.4310254259 4522813.730127485, 594627.6428971349 4522814.315218597, 594628.108370599 4522815.079166584, 594629.4119893719 4522817.180292628, 594629.7836780364 4522817.848390635, 594629.9668162147 4522818.419456693, 594630.9158658219 4522822.687557745, 594632.1362842089 4522828.914627742, 594632.4809485832 4522830.776255089, 594632.7394671144 4522833.05510703, 594632.8245901242 4522833.90959153, 594632.9182749547 4522834.005440373, 594632.917191803 4522834.100307172, 594633.0098934429 4522834.29102396, 594633.1973619201 4522834.482822758, 594633.3848303985 4522834.674621555, 594633.5733820222 4522834.77155355, 594633.7619325098 4522834.86858551, 594633.9515661482 4522834.87075067, 594634.1411997814 4522834.872915829, 594634.2359666215 4522834.873997839, 594634.5204670586 4522834.877246151, 594634.8059506828 4522834.78562652, 594635.4718835533 4522834.603571514, 594636.0451147886 4522834.230799719, 594636.3317803883 4522834.044414389, 594636.5235791869 4522833.85694591, 594636.7142948303 4522833.764344232, 594636.8112268255 4522833.575792605, 594636.9082587892 4522833.387242121, 594637.0051907843 4522833.19869049, 594637.1043879056 4522832.82050636, 594637.2013210428 4522832.631854766, 594637.2034862015 4522832.442221129, 594637.20565136 4522832.252587493, 594636.6789715996 4522828.548186089, 594635.8271545352 4522820.098513478, 594635.3834337108 4522817.438130269, 594634.5755005379 4522813.446080132, 594633.7567427299 4522810.40209823, 594633.2956995112 4522809.258884104, 594632.8334743258 4522808.210435678, 594632.7396906716 4522808.114485737, 594632.6460058395 4522808.018636893, 594632.5522221825 4522807.922686949, 594632.4574553478 4522807.921604948, 594632.3636705475 4522807.825754968, 594630.3020807185 4522803.985354777, 594630.1171299941 4522801.655354245, 594631.1248612038 4522796.799628741, 594631.5586338594 4522794.368116318, 594632.3248856366 4522793.184226864, 594633.0881638918 4522792.646061672, 594633.5428710147 4522790.894139091, 594633.353058125 4522786.984729802, 594634.0693205523 4522782.04429426, 594633.9150028032 4522779.491892377, 594632.5624665357 4522775.116507147, 594632.4916122896 4522774.430848543, 594633.076605519 4522773.842258378, 594634.4612896753 4522773.615621177, 594637.8822725578 4522772.990925819, 594640.8293224506 4522772.360719365, 594641.4003885088 4522772.177581122, 594641.877669752 4522771.898592905, 594642.4509020799 4522771.525721054, 594642.9304484238 4522771.057100333, 594643.4110779061 4522770.49361281, 594643.7979237227 4522769.834175344, 594644.0888195971 4522769.268521545, 594644.3808985696 4522768.608002086, 594645.2666769295 4522765.77323997, 594645.5749949357 4522763.690418205, 594645.7054869558 4522760.562495115, 594645.8036008829 4522760.279177768, 594645.9027979382 4522759.900993613, 594646.2961391201 4522758.672655212, 594646.4911861509 4522758.200686249, 594646.5902832415 4522757.822500953, 594646.5935303587 4522757.53810047, 594646.5009286472 4522757.347384838, 594646.5030937727 4522757.157751194, 594646.4103920931 4522756.967034414, 594646.317791521 4522756.776218816, 594646.2250898411 4522756.585502043, 594646.0376213272 4522756.393703274, 594645.849069676 4522756.296771311, 594645.4730506454 4522756.007940611, 594644.9073968375 4522755.717044754, 594644.3406610377 4522755.520915739, 594642.1663195554 4522754.92711531, 594631.8808353218 4522750.447439556, 594630.8421305859 4522750.056263535, 594628.4781555277 4522749.460298027, 594627.8144877856 4522749.452720671, 594627.0559532515 4522749.444060182, 594626.3900204264 4522749.626115319, 594625.6293207674 4522749.807088464, 594624.1035912095 4522750.548302016, 594622.1941641825 4522751.664451439, 594620.6630212541 4522752.879799042, 594619.1297132038 4522754.284780262, 594617.782691704 4522755.976325926, 594616.4336050395 4522757.857506345, 594615.1771189347 4522759.929502338, 594614.2072995203 4522761.81501299, 594613.5240456845 4522763.514137126, 594613.1263742656 4522765.121742693, 594613.0175335183 4522766.353329263, 594613.0023776081 4522767.680764661, 594613.1768541831 4522769.010465148, 594613.5420486598 4522770.247364009, 594614.0936273492 4522771.771028397, 594614.7444042341 4522772.916408705, 594615.0323338064 4522773.284815943, 594615.4024185715 4522774.522470495, 594615.6734967716 4522778.529686178, 594616.2623741737 4522782.557126689, 594615.5756547228 4522787.099186889, 594614.8467664588 4522789.879252461, 594614.8674549732 4522792.384238604), (594618.9116443855 4522791.475522819, 594617.7732181982 4522789.240512805, 594619.2161811623 4522783.331589034, 594620.4307067465 4522778.901431744, 594620.3930837843 4522776.574912989, 594620.7052141157 4522775.357844772, 594620.8976258669 4522775.072904678, 594621.9267656893 4522775.084654837, 594625.6588444355 4522774.795838457, 594627.2161641449 4522775.701124203, 594629.1084868275 4522778.788856464, 594630.0026731484 4522783.87795061, 594629.8339972025 4522789.378216612, 594628.6425228592 4522791.798178609, 594625.1439971291 4522792.393094804, 594624.0925769696 4522792.730313535, 594622.4727561466 4522792.737013704, 594618.9116443855 4522791.475522819)))'
    poly = wkt.loads(poly)

    df = concavity.find_convex_vertices(poly, 0, filter_type='peak')
    assert len(df)>0

    df = concavity.find_convex_vertices(poly, 10, filter_type='all')
    assert len(df) > 0

    df = concavity.find_concave_vertices(poly, 0, filter_type='peak')
    assert len(df) > 0

    df = concavity.find_concave_vertices(poly, 10, filter_type='all')
    assert len(df) > 0


def test_triangle():
    poly = 'MULTIPOLYGON (((594647.0667507884 4522674.566219987, 594646.592616698 4522674.560806693, 594646.1173994918 4522674.650260204,594647.0667507884 4522674.566219987)))'
    poly = wkt.loads(poly)

    df = concavity.find_convex_vertices(poly, 0, filter_type='all')
    assert len(df)>0

    df = concavity.find_concave_vertices(poly, 0, filter_type='all')
    assert len(df)==0

def test_concave_hull_tri():
    tri = np.array([(594647.0667507884, 4522674.566219987),
                    (594646.592616698, 4522674.560806693),
                    (594646.1173994918, 4522674.650260204)])
    ch = concavity.concave_hull(tri, 3)
    assert isinstance(ch, Polygon)

def test_concave_hull_empty_tri():
    tri = np.array([(594647.0667507884, 4522674.566219987),
                    (594646.592616698, 4522674.560806693),
                    (594647.0667507884, 4522674.566219987)])
    ch = concavity.concave_hull(tri, 3)
    assert isinstance(ch, Polygon)
    assert ch.is_empty

def test_concave_hull():
    x = np.random.normal(100000, 500, 1000)
    y = np.random.normal(100000, 500, 1000)
    coords = np.array(list(zip(x, y)))

    ch = concavity.concave_hull(coords, knn = 50)

    filter_ = [Point(i).intersects(ch) for i in coords]
    assert coords[filter_].shape[0] == coords.shape[0]

def test_list_coords():
    np.random.seed(seed=456)
    x = np.random.normal(100000, 500, 1000)
    y = np.random.normal(100000, 500, 1000)
    coords = np.array(list(zip(x, y)))
    df = gpd.GeoSeries([Point(c) for c in coords])
    c = list(zip(df.x.tolist(),
                 df.y.tolist()))
    ch = concavity.concave_hull(c, 20)
    assert isinstance(ch, Polygon)
